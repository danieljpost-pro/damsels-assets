{% extends "base.html" %}

{% block title %}{{ config.title }} - Enter the Realm{% endblock %}

{% block content %}
<main class="welcome">
    <div class="welcome__container">
        <h1 class="welcome__title">{{ config.title }}</h1>
        <p class="welcome__tagline">{{ section.content | safe }}</p>
        
        <!-- Step 1: Login/Register -->
        <section id="step-login" class="step step--active">
            <form class="login-form" id="login-form">
                <div class="login-form__field">
                    <label for="username" class="login-form__label">Choose Your Name</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="login-form__input"
                        placeholder="Enter username..."
                        required
                        autocomplete="username"
                        minlength="2"
                        maxlength="24"
                    >
                </div>
                
                <div class="login-form__error" id="login-error"></div>
                
                <button type="submit" class="login-form__submit">
                    <span class="btn-text">Enter</span>
                    <span class="btn-loading">Connecting...</span>
                </button>
            </form>
        </section>
        
        <!-- Step 2: Room Selection -->
        <section id="step-room" class="step">
            <div class="player-greeting" id="player-greeting"></div>
            
            <div class="room-options">
                <button class="room-option" id="btn-create-room">
                    <span class="room-option__icon">‚öî</span>
                    <span class="room-option__title">Create Room</span>
                    <span class="room-option__desc">Start a new session</span>
                </button>
                
                <div class="room-divider">
                    <span>or</span>
                </div>
                
                <form class="join-form" id="join-form">
                    <div class="join-form__header">
                        <span class="room-option__icon">üîó</span>
                        <span class="room-option__title">Join Room</span>
                    </div>
                    <div class="join-form__field">
                        <input 
                            type="text" 
                            id="room-code" 
                            name="room-code" 
                            class="login-form__input join-form__input"
                            placeholder="XXXXX"
                            pattern="[A-Za-z0-9]{5}"
                            maxlength="5"
                        >
                        <button type="submit" class="join-form__submit">‚Üí</button>
                    </div>
                    <div class="login-form__error" id="join-error"></div>
                </form>
            </div>
        </section>
        
        <!-- Step 3: Role Selection -->
        <section id="step-role" class="step">
            <div class="role-header">
                <span class="role-header__room" id="current-room-code"></span>
                <span class="role-header__label">Choose Your Role</span>
            </div>
            
            <div class="role-grid">
                <button class="role-card" data-role="Top">
                    <span class="role-card__icon">üëë</span>
                    <span class="role-card__name">Top</span>
                    <span class="role-card__desc">Lead the encounter</span>
                </button>
                
                <button class="role-card" data-role="Bottom">
                    <span class="role-card__icon">üåπ</span>
                    <span class="role-card__name">Bottom</span>
                    <span class="role-card__desc">Surrender control</span>
                </button>
                
                <button class="role-card" data-role="Observer">
                    <span class="role-card__icon">üëÅ</span>
                    <span class="role-card__name">Observer</span>
                    <span class="role-card__desc">Watch in silence</span>
                </button>
                
                <button class="role-card" data-role="Photographer">
                    <span class="role-card__icon">üì∏</span>
                    <span class="role-card__name">Photographer</span>
                    <span class="role-card__desc">Document the moment</span>
                </button>
                
                {# DEV ONLY: ActivityAdmin role card - only included if dev_mode is true #}
                {% if config.extra.dev_mode %}
                <button class="role-card role-card--dev" data-role="ActivityAdmin" id="role-activity-admin" style="display: none;">
                    <span class="role-card__icon">‚öôÔ∏è</span>
                    <span class="role-card__name">Admin</span>
                    <span class="role-card__desc">Manage activities</span>
                    <span class="role-card__dev-badge">DEV</span>
                </button>
                {% endif %}
            </div>
            
            <div class="login-form__error" id="role-error"></div>
        </section>
        
        {# DEV ONLY: Admin Panel - only included if dev_mode is true #}
        {% if config.extra.dev_mode %}
        <section id="step-admin" class="step admin-panel">
            <div class="admin-header">
                <h2 class="admin-title">Activity Admin</h2>
                <span class="admin-badge">DEVELOPMENT</span>
                <button class="admin-back" id="admin-back">‚Üê Back</button>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab admin-tab--active" data-tab="categories">Categories</button>
                <button class="admin-tab" data-tab="activities">Activities</button>
                <button class="admin-tab" data-tab="prerequisites">Prerequisites</button>
            </div>
            
            <div class="admin-content" id="tab-categories">
                <form class="admin-form" id="form-category">
                    <h3 class="admin-form__title">New Category</h3>
                    <div class="admin-form__row">
                        <input type="text" name="name" placeholder="Category name" class="admin-input" required>
                        <input type="number" name="display_order" placeholder="Order" class="admin-input admin-input--small" value="0">
                    </div>
                    <textarea name="description" placeholder="Description..." class="admin-textarea" required></textarea>
                    <button type="submit" class="admin-btn">Create Category</button>
                </form>
                <div class="admin-list" id="list-categories">
                    <p class="admin-list__empty">No categories yet</p>
                </div>
            </div>
            
            <div class="admin-content admin-content--hidden" id="tab-activities">
                <form class="admin-form" id="form-activity">
                    <h3 class="admin-form__title">New Activity</h3>
                    <div class="admin-form__row">
                        <select name="category_id" class="admin-select" required>
                            <option value="">Select category...</option>
                        </select>
                    </div>
                    <input type="text" name="name" placeholder="Activity name" class="admin-input" required>
                    <textarea name="description" placeholder="Short description..." class="admin-textarea" required></textarea>
                    <textarea name="instructions" placeholder="Full instructions..." class="admin-textarea admin-textarea--tall" required></textarea>
                    <input type="url" name="video_url" placeholder="Video URL (optional)" class="admin-input">
                    <div class="admin-form__row">
                        <div class="admin-field">
                            <label class="admin-label">XP Required</label>
                            <input type="number" name="xp_required" class="admin-input" value="0" min="0">
                        </div>
                        <div class="admin-field">
                            <label class="admin-label">XP Reward</label>
                            <input type="number" name="xp_reward" class="admin-input" value="10" min="0">
                        </div>
                    </div>
                    <button type="submit" class="admin-btn">Create Activity</button>
                </form>
                <div class="admin-list" id="list-activities">
                    <p class="admin-list__empty">No activities yet</p>
                </div>
            </div>
            
            <div class="admin-content admin-content--hidden" id="tab-prerequisites">
                <form class="admin-form" id="form-prerequisite">
                    <h3 class="admin-form__title">Add Prerequisite</h3>
                    <div class="admin-form__row">
                        <div class="admin-field">
                            <label class="admin-label">Activity</label>
                            <select name="activity_id" class="admin-select" id="prereq-activity" required>
                                <option value="">Select activity...</option>
                            </select>
                        </div>
                        <span class="admin-arrow">requires ‚Üí</span>
                        <div class="admin-field">
                            <label class="admin-label">Prerequisite</label>
                            <select name="prerequisite_id" class="admin-select" id="prereq-prereq" required>
                                <option value="">Select prerequisite...</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="admin-btn">Add Prerequisite</button>
                </form>
                <div class="admin-list" id="list-prerequisites">
                    <p class="admin-list__empty">No prerequisites yet</p>
                </div>
            </div>
            
            <div class="login-form__error" id="admin-error"></div>
        </section>
        {% endif %}
        
        <!-- Connection Status -->
        <div class="connection-status" id="connection-status">
            <span class="connection-status__dot"></span>
            <span class="connection-status__text">Connecting...</span>
        </div>
    </div>
</main>

<script type="module" src="{{ get_url(path='js/app.js') }}"></script>
{% endblock %}
